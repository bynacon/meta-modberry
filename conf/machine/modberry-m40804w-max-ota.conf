#@TYPE: Machine
#@NAME: Modberry with RPi CM4 (64-bit) by Bynacon
#@DESCRIPTION: This is an OTA image for Modberry based on RPi CM4 in 64-bit but you need the private meta-ota of bynacon or create your own meta-ota for mender-ota.
include conf/machine/modberry-m40804w-max.conf
BBMASK = " \
    meta-edgecon/ \
"

###############################################################################
### Mender configuration
###############################################################################

PREFERRED_PROVIDER_u-boot-fw-utils = "libubootenv"

PREFERRED_VERSION_mender-client = "3.3.0"
PREFERRED_VERSION_mender-artifact = "3.8.0"
PREFERRED_VERSION_mender-artifact-native = "3.8.0"
PREFERRED_VERSION_mender-connect = "2.0.1"

MENDER_UBOOT_STORAGE_INTERFACE = "mmc"
MENDER_UBOOT_STORAGE_DEVICE = "0"

MENDER_DTB_NAME= "broadcom/bcm2711-rpi-cm4.dtb"

MENDER_UBOOT_ENV_STORAGE_DEVICE_OFFSET_1 = "0x400000" 
MENDER_UBOOT_ENV_STORAGE_DEVICE_OFFSET_2 = "0x800000"

MENDER_PARTITION_ALIGNMENT = "4194304"

MENDER_UPDATE_POLL_INTERVAL_SECONDS = "5"
MENDER_INVENTORY_POLL_INTERVAL_SECONDS = "5"
MENDER_RETRY_POLL_INTERVAL_SECONDS = "30"

INHERIT += "mender-full"

MENDER_FEATURES_ENABLE:append = " mender-uboot mender-image-sd"
MENDER_FEATURES_DISABLE:append = " mender-grub mender-image-uefi"

MENDER_BOOT_PART_SIZE_MB = "64"
MENDER_STORAGE_TOTAL_SIZE_MB = "6144"
ARTIFACTIMG_FSTYPE = "ext4"

IMAGE_INSTALL:append = " mender-connect"

### Update Raspberry Pi firmware files ###
#INHERIT += "rpi-update-firmware"